# Smart Image Loader ğŸ–¼ï¸

Un chargeur d'images flexible qui prend en charge plusieurs sources d'entrÃ©e avec ordre de prioritÃ©, extraction de metadatas et de workflow.

**CatÃ©gorie :** `TOO-Pack/image`

---

## ğŸ“‹ FonctionnalitÃ©s

- **Sources multiples** : txt, chemin direct, rÃ©pertoire ou entrÃ©e d'image directe
- **SÃ©lection alÃ©atoire** avec seed reproductible
- **Extraction de mÃ©tadonnÃ©es** : format A1111/Civitai + workflow ComfyUI
- **Formats multiples** pris en charge (PNG, JPG, JPEG, BMP, WEBP, TIFF)
- **AperÃ§u d'image** pour img_path
- **Retourne le chemin du fichier** de l'image chargÃ©e

---

## âš™ï¸ ParamÃ¨tres

### ParamÃ¨tres requis

| ParamÃ¨tre | Type | Description | DÃ©faut |
|-----------|------|-------------|------------|
| **seed** | <span style="background-color:#1e4d3e;color:#34d399;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">INT</span> | Seed pour une sÃ©lection alÃ©atoire reproductible | `0` |
| **img_dir_level** | <span style="background-color:#1e4d3e;color:#34d399;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">INT</span> | Profondeur des sous-rÃ©pertoires : -1=tous, 0=actuel, 1-10=niveaux | `0` |
| **show_preview** | <span style="background-color:#888e;color:#ccc;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">BOOLEAN</span> | Afficher l'aperÃ§u de l'image dans le nÅ“ud | `True` |

### ParamÃ¨tres optionnels

| ParamÃ¨tre | Type | Description | DÃ©faut |
|-----------|------|-------------|------------|
| **txt_path** | <span style="background-color:#1e3a5f;color:#60a5fa;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">STRING</span> | Chemin vers un fichier texte contenant des chemins d'images | - |
| **img_path** | <span style="background-color:#1e3a5f;color:#60a5fa;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">STRING</span> | Chemin direct vers un fichier image | - |
| **img_directory** | <span style="background-color:#1e3a5f;color:#60a5fa;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">STRING</span> | Chemin vers un rÃ©pertoire contenant des images | - |
| **image** | <span style="background-color:#7c2d12;color:#fb923c;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">IMAGE</span> | EntrÃ©e d'image directe | - |

### Sorties

| ParamÃ¨tre | Type | Description |
|-----------|------|-------------|
| **IMAGE** | <span style="background-color:#7c2d12;color:#fb923c;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">IMAGE</span> | L'image chargÃ©e sous forme de tenseur |
| **FILE_PATH** | <span style="background-color:#1e3a5f;color:#60a5fa;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">STRING</span> | Chemin du fichier chargÃ© ("external_input" ou "none") |
| **metadata** | <span style="background-color:#7c2d12;color:#fb923c;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">METADATA</span> | MÃ©tadonnÃ©es A1111/Civitai extraites du fichier |
| **workflow** | <span style="background-color:#7c2d12;color:#fb923c;padding:2px 8px;border-radius:4px;font-family:monospace;font-size:0.9em;">WORKFLOW</span> | Workflow ComfyUI extrait du fichier |

---

## ğŸ¯ Ordre de prioritÃ©

Le nÅ“ud charge les images dans cet ordre (de la prioritÃ© la plus haute Ã  la plus basse) :

1. **image** âš¡ : Utilise l'entrÃ©e d'image fournie (pour passer des images uniquement - ne charge pas les mÃ©tadonnÃ©es ou le workflow)
2. **txt_path** ğŸ“„ : SÃ©lectionne alÃ©atoirement un chemin dans le fichier texte
3. **img_path** ğŸ–¼ï¸ : Charge le fichier image spÃ©cifique
4. **img_directory** ğŸ“ : SÃ©lectionne alÃ©atoirement une image dans le rÃ©pertoire

---

## ğŸ’¡ Exemples d'utilisation

### Cas 1 : Fichier texte avec liste d'images
```python
# Contenu de image_list.txt :
# /path/to/image1.png
# /path/to/image2.jpg
# /path/to/image3.webp

txt_path = "/path/to/image_list.txt"
seed = 42  # Reproductible
```
âœ SÃ©lectionne alÃ©atoirement une image de la liste

### Cas 2 : Chemin direct vers une image
```python
img_path = "/path/to/specific/image.png"
```
âœ Charge cette image directement

### Cas 3 : RÃ©pertoire d'images alÃ©atoires
```python
img_directory = "/path/to/images/"
seed = 123
```
âœ SÃ©lectionne alÃ©atoirement une image dans le rÃ©pertoire
âœ metadata/workflow

### Cas 4 : EntrÃ©e d'image directe
```python
# Connecter une IMAGE depuis un autre nÅ“ud
image = <IMAGE from another node>
```
âœ Utilise l'image fournie

### Cas 5 : Combinaison avec prioritÃ©
```python
txt_path = "/path/to/list.txt"       # PrioritÃ© 1
img_path = "/path/to/fallback.png"   # PrioritÃ© 2 (si txt_path Ã©choue)
img_directory = "/path/to/backup/"   # PrioritÃ© 3 (si img_path Ã©choue)
```
âœ Utilise la premiÃ¨re source valide trouvÃ©e

---

## ğŸ–¼ï¸ AperÃ§u

- **L'aperÃ§u fonctionne UNIQUEMENT pour img_path**
- **AperÃ§u dÃ©sactivÃ© pour txt_path et img_directory** (le mode alÃ©atoire est trop trompeur pour une telle fonctionnalitÃ©)
- Basculer avec le paramÃ¨tre `show_preview` ou le menu contextuel

---

## ğŸ“Š Format des mÃ©tadonnÃ©es

Extrait le format A1111/Civitai depuis :
- **PNG** : chunk `parameters`
- **JPEG/WEBP** : EXIF `UserComment`

Retourne un dictionnaire avec :
- `positive`, `negative` (prompts)
- `seed`, `steps`, `cfg`, `sampler_name`, `scheduler`
- `model_name`, `model_hash`, `lora_hashes`

---

## ğŸ“‚ Formats pris en charge

| Extension | Description |
|-----------|-------------|
| `.png` | Portable Network Graphics |
| `.jpg`, `.jpeg` | JPEG |
| `.bmp` | Bitmap |
| `.webp` | WebP |
| `.tiff` | Tagged Image File Format |

---

## ğŸ”§ DÃ©tails techniques

### Format du fichier texte (txt_path)

Le fichier texte doit contenir un chemin d'image par ligne :

```
/home/user/images/photo1.png
/home/user/images/photo2.jpg
/home/user/images/photo3.webp
```

- Les lignes vides sont ignorÃ©es
- Encodage UTF-8 pris en charge
- Un chemin alÃ©atoire est sÃ©lectionnÃ© en utilisant le seed

### Gestion du seed

- **seed = 0** : SÃ©lection alÃ©atoire diffÃ©rente Ã  chaque exÃ©cution
- **seed > 0** : SÃ©lection identique avec les mÃªmes paramÃ¨tres (reproductible)

### Valeurs de FILE_PATH

| Valeur | Description |
|--------|-------------|
| Chemin complet | Image chargÃ©e depuis txt_path, img_path ou img_directory |
| `"external_input"` | Image fournie via le paramÃ¨tre image |
| `"none"` | Aucune source valide trouvÃ©e (erreur) |

---

## ğŸ“ Notes

- Le nÅ“ud convertit automatiquement toutes les images en RGB
- Les images sont normalisÃ©es (valeurs 0-1) pour ComfyUI
- Le seed n'affecte que txt_path et img_directory (sÃ©lection alÃ©atoire)

---

## ğŸ“„ Licence

MIT

---

## ğŸ™ CrÃ©dits

- **ComfyUI** - Framework basÃ© sur les nÅ“uds
- **PIL/Pillow** - Manipulation d'images
- **PyTorch** - Tenseurs pour ComfyUI

---

## ğŸ“§ Contact

Pour signaler un bug ou suggÃ©rer une amÃ©lioration :
- CrÃ©er une issue
- Soumettre une PR
